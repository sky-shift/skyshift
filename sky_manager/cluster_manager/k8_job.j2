apiVersion: batch/v1
kind: Job
metadata:
  name: {{k8_name}}
  labels: 
    manager: sky_manager
    cluster: {{cluster_name}}
    job_id: {{job_id}}
spec:
  parallelism: {{replicas}}
  completions: {{replicas}}
  backoffLimit: 0  
  template: 
    spec:
      restartPolicy: Never  
      volumes: 
      - name: dshm
        emptyDir: 
          medium: Memory
      containers: 
      - name: sky-manager-container
        image: {{image}}
        volumeMounts: 
        - name: dshm
          mountPath: /dev/shm
        command: ["/bin/sh", "-c"]
        args:
        - |          
          {{run}}
        resources:
          limits:
            cpu: {{cpu}}
            {% if gpu is not none and gpu != 0 %}
            nvidia.com/gpu: {{ gpu }}
            {% endif %}
          requests:
            cpu: {{cpu}}
            {% if gpu is not none and gpu != 0 %}
            nvidia.com/gpu: {{ gpu }}
            {% endif %}